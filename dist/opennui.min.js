var oNUI={},NUIBody=function(){this.joints={}},NUIJoint=function(a,b,c,d){this.status=a,this.x=b,this.y=c,this.z=d,this.dx=0,this.dy=0,this.dz=0},NUIEvent=function(a){this.type=a};!function(){"use strict";"undefined"==typeof jQuery&&console.error("jQuery is not defined."),$.extend(oNUI,{URL:{LIFE_SOCKET:"ws://localhost:8001/",EVENT_SOCKET:function(a){return"ws://localhost:"+a+"/"},SENSOR_SOCKET:"ws://localhost/sensor"},RECEIVE_PACKET_TYPE:{HELLO:1,READY_CONNECTION:2,TEST_TEXTMESSAGE:3,RESPONSE_SHARED_MEMORY:4,EVENT:16},REQUEST_PACKET_TYPE:{HELLO_ACK:1,READY_CONNECTION_ACK:2,TEST_TEXTMESSAGE:3,REQUEST_SHARED_MEMORY:4},EVENT_TYPE:{HAND_STATUS_CHANGE:0,HAND_POSITION_CHANGE:1,FACE_DATA_CHANGE:2,PATTERN_DATA_CHANGE:3,GESTURE_DETECTED:4,SENSOR_CREATED:5,SENSOR_STATUS_CHANGED:6,USER_CUSTOM:7},NUI_EVENT:["handStatusChange","handPositionChange","faceDataChange","patternDataChange","gestureDetected","sensorCreated","sensorStatusChanged"],Events:{COLOR_FRAME_UPDATED:"ColorFrameUpdated",DEPTH_FRAME_UPDATED:"DepthFrameUpdated",SKELETON_UPDATED:"SkeletonUpdated"},JointType:{HEAD:3,LEFT_HAND:7,RIGHT_HAND:11},SensorState:{OPENED:"sensorOpened",SUSPENDED:"sensorSuspended"},SkeletonState:{MISSING:"skeletonMissing",DETECTED:"skeletonDetected"}})}();var ByteArray=function(a){this.buffer=a.byteLength?a:new ArrayBuffer(a),this.view=new DataView(this.buffer),this.position=0,Object.defineProperty(this,"bytesAvailable",{get:function(){return this.buffer.byteLength-this.position}}),this.readUnsignedByte=function(){return this.view.getUint8(this.position++,!0)},this.readUnsignedShort=function(){return this.view.getUint16((this.position+=2)-2,!0)},this.readShort=function(){return this.view.getInt16((this.position+=2)-2,!0)},this.readUnsignedInt=function(){return this.view.getUint32((this.position+=4)-4,!0)},this.readFloat=function(){return this.view.getFloat32((this.position+=4)-4,!0)},this.readDouble=function(){return this.view.getFloat64((this.position+=8)-8,!0)},this.writeUnsignedByte=function(a){this.view.setUint8(this.position++,a,!0)},this.writeUnsignedShort=function(a){this.view.setUint16((this.position+=2)-2,a,!0)},this.writeUnsignedInt=function(a){this.view.setUint32((this.position+=4)-4,a,!0)}},NUISocket=function(a,b,c,d){this.socket=new WebSocket(a),this.socket.container=this,this.socket.binaryType="arraybuffer",this.onOpen=b,this.onClose=c,this.onMessage=d,this.socket.onopen=function(a){this.container.onOpen&&this.container.onOpen(a)},this.socket.onclose=function(a){this.container.onClose&&this.container.onClose(a)},this.socket.onmessage=function(a){this.container.onMessage&&this.container.onMessage(a)},this.send=function(a,b){var c=new ByteArray(512);switch(c.writeUnsignedShort(11647),a){case oNUI.REQUEST_PACKET_TYPE.HELLO_ACK:c.writeUnsignedInt(6),c.writeUnsignedInt(0),c.writeUnsignedInt(0),c.writeUnsignedShort(0),c.writeUnsignedShort(a),c.writeUnsignedInt(1);break;case oNUI.REQUEST_PACKET_TYPE.READY_CONNECTION_ACK:c.writeUnsignedInt(6),c.writeUnsignedInt(0),c.writeUnsignedInt(0),c.writeUnsignedShort(0),c.writeUnsignedShort(a),c.writeUnsignedInt(oNUI.id)}this.socket.send(c.buffer)}};!function(){$.extend(oNUI,{parsePacket:function(a){var b=new ByteArray(a),c={head:{},body:{},view:b};if(32557!=b.readUnsignedShort())throw new Error("Invalid packet header");return c.head.bodyLength=b.readUnsignedInt(),b.position=16,c.body.kind=b.readShort(),c.body.kind==oNUI.RECEIVE_PACKET_TYPE.EVENT&&(c.body.eventType=b.readUnsignedInt()),c},onReveicePacket:function(a){var b=oNUI.parsePacket(a.data);switch(b.body.kind){case oNUI.RECEIVE_PACKET_TYPE.HELLO:oNUI.id=b.view.readUnsignedInt(),oNUI.lifeSocket.send(oNUI.REQUEST_PACKET_TYPE.HELLO_ACK);break;case oNUI.RECEIVE_PACKET_TYPE.READY_CONNECTION:var c=b.view.readUnsignedInt();oNUI.eventSocket=new NUISocket(oNUI.URL.EVENT_SOCKET(c),oNUI.onConnected,oNUI.onDisconnected,oNUI.onReveicePacket);break;case oNUI.RECEIVE_PACKET_TYPE.EVENT:oNUI.parseEventPacket(b),$("#NUIHandler").trigger(oNUI.NUI_EVENT[b.body.eventType],new NUIEvent(b.body.eventType))}},parseEventPacket:function(a){var b,c,d=a.view;switch(a.body.data=new Array,a.body.eventType){case oNUI.EVENT_TYPE.HAND_STATUS_CHANGE:c={type:d.readUnsignedInt(),status:d.readUnsignedShort()},b=oNUI.body[0].joints[c.type],b.status=c.status;break;case oNUI.EVENT_TYPE.HAND_POSITION_CHANGE:c={type:d.readUnsignedInt(),status:d.readUnsignedShort(),x:d.readDouble(),y:d.readDouble(),z:d.readDouble()},b=oNUI.body[0].joints[c.type],b.dx=c.x-b.x,b.dy=c.y-b.y,b.dz=c.z-b.z,b.x=c.x,b.y=c.y,b.z=c.z,b.status=c.status}return a},onConnected:function(a){oNUI.eventSocket.send(oNUI.REQUEST_PACKET_TYPE.READY_CONNECTION_ACK,[])},onDisconnected:function(a){console.info("Fucking Framework")}})}(),function(){oNUI.lifeSocket=new NUISocket(oNUI.URL.LIFE_SOCKET,function(a){console.info("OhNUI Module Loaded!")},null,oNUI.onReveicePacket),oNUI.body=[new NUIBody];for(var a in oNUI.JointType)oNUI.body[0].joints[oNUI.JointType[a]]=new NUIJoint(0,0,0,0);$("body").append($("<div id='NUIHandler'>").hide())}();